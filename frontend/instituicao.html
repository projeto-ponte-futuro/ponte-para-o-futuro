<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>P√°gina da Institui√ß√£o</title>
  <link rel="stylesheet" href="aluno/aluno.css" />
  <script src="script.js" defer></script>
</head>
<body class="instituicao">
  <div class="dashboard">
   <aside class="sidebar">
  <!-- Container da foto com √≠cone de c√¢mera -->
  <div class="upload-container">
    <label for="foto-input" class="upload-label" style="cursor: pointer;">
      <div class="profile-pic-container">
        <img
          id="preview-img"
          class="profile-pic"
          src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
          alt="Foto de perfil"
        />
        <span class="icon-overlay">üì∑</span>
      </div>
    </label>
    <input type="file" id="foto-input" name="foto" accept="image/*" hidden />
  </div>

    <!-- Modal flutuante central -->
    <div id="foto-modal" class="modal hidden">
      <div class="modal-content">
        <p>Deseja salvar a nova foto de perfil?</p>
        <div class="modal-buttons">
          <button id="confirmar-btn" class="btn salvar">Salvar</button>
          <button id="cancelar-btn" class="btn cancelar">Cancelar</button>
        </div>
      </div>
    </div>
  </form>

  <p class="institution-name">Nome da Institui√ß√£o</p>

  <button class="sidebar-btn home" onclick="mostrarSecao('painel')">üè†</button>
  <button class="sidebar-btn" onclick="mostrarSecao('projetos')">Cadastro de Projetos</button>
  <button class="sidebar-btn" onclick="mostrarSecao('listar-projetos')">Visualizar Projetos</button>
  <button class="sidebar-btn" onclick="mostrarSecao('usuarios')">Alunos</button>
  <button class="sidebar-btn" onclick="mostrarSecao('solicitacoes')">Solicita√ß√µes</button>
  <button class="sidebar-btn" onclick="mostrarSecao('certificados')">Certificados</button>
  <a href="/frontend/login.html" class="back-button">Sair</a>
</aside>

    <main class="main-content">
      <section id="painel" class="secao-dashboard active">
  <h2>Bem-vindo(a) ao Painel da Institui√ß√£o</h2>
  <p>Este √© o seu centro de controle. Abaixo, voc√™ encontra informa√ß√µes √∫teis e um resumo geral.</p>

  <!-- Cards principais -->
  <div class="dashboard-cards">
    <div class="card">
      <h3>Alunos Cadastrados</h3>
      <p id="count-alunos">0</p>
    </div>
    <div class="card">
      <h3>Projetos Ativos</h3>
      <p id="count-projetos">0</p>
    </div>
    <div class="card">
      <h3>√öltimo Cadastro</h3>
      <p id="last-cadastro">--</p>
    </div>
  </div>

  <!-- A√ß√µes r√°pidas -->
  <h3 style="margin-top: 2rem;">A√ß√µes r√°pidas</h3>
  <div class="dashboard-cards">
    <div class="card card-acao">
      <h4>Gerenciar Projetos</h4>
      <p>Cadastre novos projetos ou edite os existentes.</p>
      <button class="btn-acao" onclick="mostrarSecao('projetos')">Cadastro de Projetos</button>
    </div>
    <div class="card card-acao">
      <h4>Acompanhar Alunos</h4>
      <p>Veja o progresso e envolvimento dos alunos vinculados.</p>
      <button class="btn-acao" onclick="mostrarSecao('usuarios')">Alunos</button>
    </div>
  </div>

  <!-- Sugest√µes √∫teis -->
  <h3 style="margin-top: 2rem;">Sugest√µes para sua institui√ß√£o</h3>
  <ul class="sugestoes-lista">
    <li>üì¢ Divulgue seus projetos para atrair mais alunos</li>
    <li>üìà Analise o envolvimento dos alunos em cada projeto</li>
    <li>üì© Use o painel para entrar em contato com mentores ou alunos</li>
    <li>üîê Mantenha seu perfil institucional sempre atualizado</li>
  </ul>
</section>


      <section id="projetos" class="secao-dashboard">

         <a href="/" class="voltar-button">
    <img src="/frontend/assets/seta-para-a-esquerda.png" alt="Voltar" />
  </a>
        <h2>Cadastro de Projetos</h2>
        <form id="form-projetos" method="POST">
          <input type="text" name="titulo" placeholder="T√≠tulo do Projeto" required/>
          <textarea name="descricao" placeholder="Descri√ß√£o do Projeto" rows="4"></textarea>
          <input type="date" name="data_inicio" placeholder="Data de in√≠cio" required/>
          <input type="date" name="data_termino" placeholder="Data do t√©rmino" required/>
          <button type="submit">Cadastrar Projeto</button>
        </form>
      </section>

      <section id="listar-projetos" class="secao-dashboard">
        <h2>Projetos Cadastrados</h2>
        <table border="1">
          <thead>
            <tr>
              <th>Id</th>
              <th>T√≠tulo</th>
              <th>Descri√ß√£o</th>
              <th>Status</th>
              <th>Data In√≠cio</th>
              <th>Data T√©rmino</th>
            </tr>
          </thead>
          <tbody id="tabela-projetos"></tbody>
        </table>
      </section>

      <section id="usuarios" class="secao-dashboard">
        
            <a href="/" class="voltar-button">
    <img src="/frontend/assets/seta-para-a-esquerda.png" alt="Voltar" />
  </a>

        <h2>Alunos Cadastrados</h2>
        <table border="1">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="corpo-tabela-alunos"></tbody>
        </table>
      </section>

      <section id="solicitacoes" class="secao-dashboard">
        <h1>Solicita√ß√µes Pendentes</h1>
        <table border="1">
          <thead>
            <tr>
              <th>Aluno</th>
              <th>Projeto</th>
              <th>Status</th>
              <th>A√ß√£o</th>
            </tr>
          </thead>
          <tbody id="tabela-solicitacoes"></tbody>
        </table>
        <div id="resposta-solicitacao" style="margin-top: 20px; display: none;">
          <h2>Responder Solicita√ß√£o</h2>
          <p><strong>Aluno:</strong> <span id="aluno-nome"></span></p>
          <p><strong>Projeto:</strong> <span id="projeto-titulo"></span></p>
          <input type="text" id="mensagem-resposta" placeholder="Mensagem para o aluno" style="width: 300px;" />
          <br /><br />
          <button id="btn-aprovar">Aprovar</button>
          <button id="btn-negar">Negar</button>
        </div>
      </section>

      <section id="certificados" class="secao-dashboard">
        <div class="wrapper">
          <form id="form-certificado" class="form-box">
            <h1>Cadastrar Certificado</h1>
            <p class="descricao">
              Preencha os dados abaixo para registrar o certificado de conclus√£o de projeto.
            </p>
            <div class="input-group">
              <label for="aluno">Nome do Aluno</label>
              <input type="text" id="aluno" name="aluno" required />
            </div>
            <div class="input-group">
              <label for="projeto">Nome do Projeto</label>
              <input type="text" id="projeto" name="projeto" required />
            </div>
            <div class="input-group">
              <label for="arquivo">Certificado (PDF)</label>
              <input type="file" id="arquivo" name="arquivo" accept=".pdf" required />
            </div>
            <button type="submit">Cadastrar</button>
            <div id="mensagem-sucesso" class="mensagem-sucesso" style="display: none">
              ‚úÖ Certificado cadastrado com sucesso!
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>

<script>
  // Verifica login e tipo
  document.addEventListener("DOMContentLoaded", () => {
    const dados = localStorage.getItem("usuarioLogado");

    if (dados) {
      const usuario = JSON.parse(dados);

      if (usuario.tipo !== "instituicao") {
        alert("Acesso n√£o autorizado.");
        window.location.href = "login.html";
      }

      console.log("Usu√°rio logado:", usuario.nome);
    } else {
      window.location.href = "login.html";
    }
  });
</script>

<script>
  function mostrarSecao(secaoId) {
    const secoes = document.querySelectorAll('.secao-dashboard');
    secoes.forEach(secao => secao.classList.remove('active'));
    document.getElementById(secaoId)?.classList.add('active');
  }

  window.addEventListener('DOMContentLoaded', () => {
    const tipoUsuario = localStorage.getItem("tipoUsuario");
    if (tipoUsuario !== "instituicao") {
      window.location.href = "login.html";
      return;
    }

    const nomeInstituicao = localStorage.getItem("instituicaoNome") || "Institui√ß√£o";

    const nomeElemento = document.querySelector('.institution-name');
    if (nomeElemento) nomeElemento.textContent = nomeInstituicao;

    const painelTitulo = document.querySelector('#painel h2');
    if (painelTitulo) painelTitulo.textContent = `Bem-vindo(a), ${nomeInstituicao}!`;
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const ativarCadastroProjeto = criarCadastroProjetoHandler("http://localhost:3000/api/projetos");
    ativarCadastroProjeto();
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const fotoInput = document.getElementById("foto-input");
  const preview = document.getElementById("preview-img");

  if (!fotoInput || !preview) return;

  fotoInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (ev) => {
      preview.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });

  preview.addEventListener("click", () => {
    fotoInput.click();
  });
});
</script>
